sources:
    osm:
        type: TopoJSON
        url:  //vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles-P6dkVl4
scene:
    background:
        color: white
layers:
    earth:
        data: { source: osm }
        draw:
            showTile:
                order: 0
                color: '#BBB'
    water:
        data: { source: osm }
        draw:
            showTile:
                order: 1
                color: white

cameras:
    perspective:
        type: flat

styles:
    space-tile:
        shaders:
            defines:
                TILE_SCALE: 0.0002445
                NORMALIZED_SHORT(x): (x * 32767.)
            blocks:
                global: |
                    // Variant to be add to both vertex and fragments shaders
                    varying vec3 v_pos;
                    //
                    // Get the coordinates in tile space
                    // ================================
                    vec2 getTileCoords () {
                        return fract(v_pos.xy*TILE_SCALE);
                    }

                position: |
                    // Normalize the attribute position of a vertex
                    v_pos = NORMALIZED_SHORT(a_position.xyz);
    showTile:
        base: polygons
        mix: space-tile
        shaders:
            blocks:
                color: |
                    vec2 st = getTileCoords();
                    // Add a line at the lower left side of each tile
                    color *= step(.003,st.x)*step(.003,st.y);